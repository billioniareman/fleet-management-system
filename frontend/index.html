<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Vehicle & Shipment Upload</title>
    <link rel="stylesheet" href="{{ request.url_for('static', path='style.css') }}">
    <!-- Leaflet CSS for the map (used with TomTom tiles) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  </head>
  <body>
    <main class="container">
      <h1>Vehicle and Shipment Import</h1>

      <section id="step1" class="card">
        <h2>1) Number of Vehicles</h2>
        <div class="row">
          <label for="vehicleCount">Enter vehicle count</label>
          <input id="vehicleCount" type="number" min="1" placeholder="e.g. 5" />
        </div>
        <div class="actions">
          <button id="proceedVehiclesBtn" class="primary">Continue to Vehicle CSV</button>
          <button id="resetBtn" class="secondary">Reset</button>
        </div>
      </section>

      <section id="step2" class="card hidden">
        <h2>2) Upload Vehicle CSV</h2>
        <p class="hint">Expected headers (order matters):</p>
        <code class="headers">
          id, vehicle_description, capacity, start_latitude, start_longitude, end_latitude, end_longitude, shift_start, shift_end, max_tasks
        </code>
        <div class="row file-row">
          <input id="vehicleCsvInput" type="file" accept=".csv" />
          <button id="downloadVehicleTemplate" class="link">Download vehicle template</button>
        </div>
        <div id="vehicleCsvStatus" class="status"></div>
        <div id="vehicleTableContainer" class="table-container"></div>
        <div class="actions">
          <button id="toShipmentsBtn" class="primary" disabled>Continue to Shipments CSV</button>
        </div>
      </section>

      <section id="step3" class="card hidden">
        <h2>3) Upload Shipments CSV</h2>
        <p class="hint">Expected headers (order matters):</p>
        <code class="headers">
          Pickup Id, Delivery Id, Description, Pickup Location Lat, Pickup Location Lng, Pickup Start Time, Pickup End Time, Delivery Location Lat, Delivery Location Lng, Delivery Start Time, Delivery End Time, Quantity, Priority
        </code>
        <div class="row file-row">
          <input id="shipmentCsvInput" type="file" accept=".csv" />
          <button id="downloadShipmentTemplate" class="link">Download shipment template</button>
        </div>
        <div id="shipmentCsvStatus" class="status"></div>
        <div id="shipmentTableContainer" class="table-container"></div>
        <div class="actions">
          <button id="showMapBtn" class="primary" disabled>Show Map</button>
        </div>
      </section>

      <section id="mapSection" class="card hidden">
        <h2>4) Map & Constraints</h2>
        <div class="row">
          <div class="controls">
            <div class="control-block">
              <h3>Zones</h3>
              <button id="startNoGo" class="secondary">Draw No-Go Zone</button>
              <button id="startGeofence" class="secondary">Draw Geofence</button>
              <button id="finishPolygon" class="secondary" disabled>Finish Polygon</button>
              <button id="clearZones" class="link">Clear Zones</button>
            </div>
            <div class="control-block">
              <h3>Geocode Addresses (Optional)</h3>
              <textarea id="addressInput" rows="5" placeholder="One address per line"></textarea>
              <div class="row">
                <input id="countryCode" type="text" maxlength="3" placeholder="Country (e.g., IN)" style="width: 130px;" />
                <button id="geocodeBtn" class="primary">Geocode & Plot</button>
              </div>
              <div id="geocodeStatus" class="status"></div>
            </div>
            <div class="control-block">
              <h3>Optimization</h3>
              <button id="optimizeBtn" class="primary" disabled>Optimize Routes</button>
              <div id="optimizeStatus" class="status"></div>
              <div class="row">
                <label><input id="useRoadRoutes" type="checkbox" checked /> Use road network (TomTom)</label>
              </div>
              <div class="row">
                <label for="vehicleLengthM">Vehicle length (m)</label>
                <input id="vehicleLengthM" type="number" min="0" step="0.1" placeholder="e.g. 12" />
              </div>
              <div class="row">
                <label for="ttApiKey">TomTom API Key</label>
                <input id="ttApiKey" type="password" placeholder="Paste key (optional)" />
              </div>
              <div class="row">
                <label for="nbApiKey">NextBillion API Key</label>
                <input id="nbApiKey" type="password" placeholder="Paste key (optional)" />
              </div>
              <div id="optimizeSummary" class="table-container"></div>
            </div>
            <div class="control-block">
              <h3>Layers</h3>
              <div class="row"><label><input id="toggleRouteSteps" type="checkbox" checked /> Route Steps</label></div>
              <div class="row"><label><input id="toggleInputDetail" type="checkbox" /> Input Detail</label></div>
            </div>
          </div>
          <div id="map" class="map"></div>
        </div>
        <div class="legend">
          <span class="dot blue"></span> Vehicle Start
          <span class="dot cyan"></span> Vehicle End
          <span class="dot green"></span> Pickup
          <span class="dot red"></span> Delivery
          <span class="dot nogo"></span> No-Go Zone
          <span class="dot fence"></span> Geofence
        </div>
      </section>

      <footer class="footnote">
        Files are parsed locally in your browser. No data is uploaded.
      </footer>
    </main>

    <!-- Leaflet JS (used with TomTom tiles) -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script src="{{ request.url_for('static', path='app.js') }}"></script>
  </body>
  </html>
